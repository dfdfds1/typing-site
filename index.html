<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Typing Practice</title>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      background: url("KakaoTalk_20250728_132331714.png") no-repeat center 46%;
      background-size: cover;
      background-attachment: fixed;
      font-family: 'Nanum Myeongjo', Georgia, serif;
      overflow: hidden;
    }
    .container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    .typing-output {
      position: absolute;
      top: 45%;
      left: 58%;
      width: 34%;
      transform: translate(-50%, -50%);
      font-size: 18px;
      color: #ccc;
      line-height: 1.8;
      white-space: pre-wrap;
      word-break: break-word;
      letter-spacing: 0.03em;
      z-index: 1;
    }
    .typing-output div { margin: 0; padding: 0; line-height: 1.8; }
    .typing-output .typed { color: #000; }
    .typing-input {
      position: absolute;
      bottom: 16%;
      left: 10%;
      width: 80%;
      font-size: 16px;
      padding: 6px;
      background: transparent;
      border: none;
      outline: none;
      color: #555;
      letter-spacing: 0.02em;
      z-index: 1;
    }
    .left-box {
      position: absolute;
      top: 26%;
      left: 11%;
      width: 540px;
      height: 560px;
      cursor: pointer;
      z-index: 2;
    }
    .media-container { width: 100%; height: 100%; }
    .media-container iframe, .media-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border: none;
    }
    .mode-btn {
      position: absolute;
      top: 14.6%;
      left: 10.5%;
      font-size: 43px;
      padding: 15px 21px;
      background: transparent;
      border: none;
      color: transparent;
      cursor: pointer;
      font-family: 'Nanum Myeongjo', serif;
      z-index: 10;
    }
    .upload-btn {
      position: absolute;
      top: 14.6%;
      left: 9.5%;
      font-size: 40px;
      padding: 14px 20px;
      background: transparent;
      border: none;
      color: transparent;
      cursor: pointer;
      font-family: 'Nanum Myeongjo', serif;
      z-index: 10;
    }
  </style>
</head>
<body>
  <input type="file" id="imageUpload" accept="image/*" style="display:none" />
  <div class="container">
    <button class="mode-btn" onclick="loadRandomScript()">문장 연습</button>
    <button class="upload-btn" onclick="openCustomInput()">문장 업로드</button>
    <div class="left-box" onclick="insertMedia()">
      <div class="media-container" id="mediaBox"></div>
    </div>
    <div id="output" class="typing-output"></div>
    <input id="input" class="typing-input" type="text" placeholder="Type here and press Enter..." />
  </div>

  <script>
    const input = document.getElementById("input");
    const output = document.getElementById("output");
    let lines = [];
    let currentLine = 0;
    let practiceMode = false;

    const sentencePool = [
      "햇살 가득한 오후, 그녀는 좋아하는 노래를 들으며 공원 벤치에 앉아 있었다.",
      "작은 새들이 나뭇가지 사이를 날아다니고, 바람은 나뭇잎을 부드럽게 흔들었다.",
      "사랑은 결국 마음을 담아 전하는 작은 행동에서 시작된다.",
      "세상이 어깨를 스치는 정도로 바쁘게 흘러갈 때가 있다.",
      "비 내리는 거리를 함께 걷던 그 장면이 자꾸 떠오른다."
    ];

    function shuffleAndPick(array, count) {
      const shuffled = array.slice().sort(() => Math.random() - 0.5);
      return shuffled.slice(0, count);
    }

    function loadRandomScript() {
      lines = shuffleAndPick(sentencePool, 15);
      currentLine = 0;
      practiceMode = true;
      renderOutput();
      renderPreview();
    }

    function openCustomInput() {
      const text = prompt("직접 입력할 문장을 붙여넣어 주세요 (줄바꿈 포함):");
      if (!text) return;
      lines = text.split("\n").filter(line => line.trim() !== "");
      currentLine = 0;
      practiceMode = true;
      renderOutput();
      renderPreview();
    }

    function renderOutput() {
      output.innerHTML = lines.map((line, index) => {
        if (index < currentLine) {
          return `<div class="typed">${line}</div>`;
        } else if (index === currentLine) {
          return `<div id="current-line">${colorizeTypedPortion(line, "")}</div>`;
        } else {
          return `<div>${line}</div>`;
        }
      }).join("");
    }

    function renderPreview() {
      if (practiceMode && currentLine < lines.length) {
        input.value = "";
        input.placeholder = lines[currentLine];
      }
    }

    function colorizeTypedPortion(line, typed) {
      let html = "";
      for (let i = 0; i < line.length; i++) {
        if (typed[i]) {
          html += `<span class="typed">${line[i]}</span>`;
        } else {
          html += `<span>${line[i]}</span>`;
        }
      }
      return html;
    }

    input.addEventListener("input", function () {
      if (!practiceMode || currentLine >= lines.length) return;
      const typed = input.value;
      const correct = lines[currentLine];
      const corrected = correct.slice(0, typed.length);
      const currentEl = document.getElementById("current-line");
      if (currentEl) {
        currentEl.innerHTML = colorizeTypedPortion(correct, corrected);
      }
    });

    input.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        if (practiceMode && currentLine < lines.length) {
          currentLine++;
          if (currentLine === lines.length) {
            setTimeout(() => {
              lines = [];
              output.innerHTML = "";
              input.placeholder = "Type here and press Enter...";
              practiceMode = false;
            }, 800);
          } else {
            renderOutput();
            renderPreview();
          }
        } else {
          const text = input.value.trim();
          if (!text) return;
          input.value = "";
          let i = 0;
          const interval = setInterval(() => {
            if (i < text.length) {
              output.innerHTML += `<span style="color:#000">${text[i]}</span>`;
              i++;
            } else {
              clearInterval(interval);
              output.innerHTML += "<br>";
            }
          }, 40);
        }
      }
    });

    function insertMedia() {
      const choice = prompt("1. YouTube 링크\n2. GIF/이미지 URL\n3. 이미지 파일 업로드\n선택 (1/2/3):");
      const box = document.getElementById("mediaBox");
      if (choice === "1") {
        const url = prompt("YouTube 링크를 입력하세요:");
        if (!url) return;
        let embedUrl = url;
        if (url.includes("watch?v=")) {
          const id = url.split("watch?v=")[1].split("&")[0];
          embedUrl = `https://www.youtube.com/embed/${id}`;
        } else if (url.includes("youtu.be")) {
          const id = url.split("youtu.be/")[1];
          embedUrl = `https://www.youtube.com/embed/${id}`;
        }
        box.innerHTML = `<iframe src="${embedUrl}" frameborder="0" allowfullscreen></iframe>`;
      } else if (choice === "2") {
        const url = prompt("이미지 또는 GIF 링크를 입력하세요:");
        if (!url) return;
        if (url.match(/\.(gif|jpg|jpeg|png)$/i)) {
          box.innerHTML = `<img src="${url}" alt="media">`;
        } else {
          alert("지원되지 않는 형식입니다.");
        }
      } else if (choice === "3") {
        document.getElementById("imageUpload").click();
      }
    }

    document.getElementById("imageUpload").addEventListener("change", function () {
      const file = this.files[0];
      if (file && file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const box = document.getElementById("mediaBox");
          box.innerHTML = `<img src="${e.target.result}" alt="media">`;
        };
        reader.readAsDataURL(file);
      } else {
        alert("이미지 파일만 업로드할 수 있습니다.");
      }
    });
  </script>
</body>
</html>

